<!-- HTML5 文書であることを宣言 -->
<!DOCTYPE html>
<!-- ルート要素。言語=日本語、Thymeleaf の名前空間を宣言 -->
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<!-- ヘッダー領域：メタ情報・タイトル・スタイル読込 -->

<head>
	<!-- 文字コードを UTF-8 に設定 -->
	<meta charset="UTF-8">
	<!-- タブに表示されるページタイトル -->
	<title>商品一覧 - フリマアプリ</title>
	<!-- 共通スタイルシートを読み込み -->
	<link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<!-- 画面本体 -->

<body>
	<!-- レイアウト中央寄せのコンテナ -->
	<div class="container">
		<!-- ページ見出し -->
		<h1>商品一覧</h1>
		<!-- 主要ナビゲーション（出品・マイページ・ログアウト） -->
		<div class="main-nav">
			<!-- 新規出品画面へのリンク -->
			<a th:href="@{/items/new}" class="button">商品を出品する</a>
			<!-- マイページへのリンク -->
			<a th:href="@{/my-page}" class="button">マイページ</a>
			<!-- ログアウト送信フォーム（POST で送信） -->
			<form th:action="@{/logout}" method="post" style="display:inline;">
				<!-- ログアウトボタン（見た目だけリンク風） -->
				<button type="submit" class="button secondary">ログアウト</button>
			</form>
		</div>
		<!-- 検索・絞り込みフォーム（GET で自身のページへ） -->
		<form th:action="@{/items}" method="get" class="filter-form">
			<!-- キーワード入力ブロック -->
			<div>
				<!-- キーワード入力欄のラベル -->
				<label for="keyword">キーワード:</label>
				<!-- 直近の検索値を保持して入力欄に反映 -->
				<input type="text" id="keyword" name="keyword" th:value="${param.keyword}">
			</div>
			<!-- カテゴリ選択ブロック -->
			<div>
				<!-- カテゴリ選択のラベル -->
				<label for="categoryId">カテゴリ:</label>
				<!-- 全カテゴリを選択肢として表示（空=全て） -->
				<select id="categoryId" name="categoryId">
					<!-- 全カテゴリを対象にするための空選択肢 -->
					<option value="">全て</option>
					<!-- categories をループして option 生成。URL パラメータと一致なら選択状態に-->
					<option th:each="category : ${categories}" th:value="${category.id}" th:text="${category.name}"
						th:selected="${param.categoryId == category.id}"></option>
				</select>
			</div>
			<!-- 検索実行ボタン -->
			<button type="submit" class="button">検索</button>
		</form>
		<!-- 商品カード一覧（レスポンシブグリッド） -->
		<div class="item-grid">
			<!-- Page<Item>の content を回して 1 カードずつ描画 -->
			<div class="item-card" th:each="item : ${items.content}">
				<!-- 詳細画面へのリンク全体でカード化 -->
				<a th:href="@{/items/{id}(id=${item.id})}">
					<!-- 画像 URL があれば表示、なければプレースホルダ -->
					<img th:src="${item.imageUrl != null ? item.imageUrl :'/images/placeholder.png'}" alt="商品画像">
					<!-- 商品名を見出しとして表示 -->
					<h3 th:text="${item.name}"></h3>
					<!-- 価格を通貨風に整形（¥＋カンマ区切り） -->
					<p class="price" th:text="'¥' + ${#numbers.formatDecimal(item.price, 0,'COMMA', 0, 'POINT')}"></p>
					<!-- 出品ステータス（出品中/売却済）を表示 -->
					<p class="status" th:text="${item.status}"></p>
				</a>
			</div>
			<!-- 検索結果が 0 件のときにメッセージ表示 -->
			<div th:if="${#lists.isEmpty(items.content)}">
				<!-- 商品なしのメッセージ -->
				<p>商品が見つかりませんでした。</p>
			</div>
		</div>
		<!-- ページネーション（前へ/ページ番号/次へ） -->
		<div class="pagination">
			<!-- 前ページが存在する場合のみリンク表示 -->
			<a th:if="${items.hasPrevious()}"
				th:href="@{/items(page=${items.number - 1},keyword=${param.keyword}, categoryId=${param.categoryId})}">前へ</a>
			<!-- 0〜(総ページ-1)のシーケンスを生成してページ番号リンクを作成 -->
			<span th:each="i : ${#numbers.sequence(0, items.totalPages - 1)}">
				<!-- 現在ページ以外はリンクとして表示 -->
				<a th:if="${i != items.number}"th:href="@{/items(page=${i},keyword=${param.keyword}, categoryId=${param.categoryId})}"
					th:text="${i + 1}"></a>
				<!-- 現在ページは強調表示（リンクではない） -->
				<span th:if="${i == items.number}" class="current-page" th:text="${i +
					1}"></span>
			</span>
			<!-- 次ページが存在する場合のみリンク表示 -->
			<a th:if="${items.hasNext()}" th:href="@{/items(page=${items.number + 1},keyword=${param.keyword}, categoryId=${param.categoryId})}">次へ</a>
		</div>
	</div>
</body>

</html>