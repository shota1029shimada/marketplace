<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>新規登録 - フリマアプリ</title>
	<link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>
	<!-- 共通ヘッダー -->
	<div th:replace="~{fragments/header :: header}"></div>
	<div class="container">
		<h1>フリマアプリ</h1>
		<h2>新規登録</h2>

		<form th:action="@{/register}" th:object="${form}" method="post">
			<div th:if="${#fields.hasGlobalErrors()}" class="error-message">
				<div th:each="e : ${#fields.globalErrors()}" th:text="${e}"></div>
			</div>

			<p>
				<label for="name">名前:</label>
				<input id="name" type="text" th:field="*{name}" required>
				<div class="error-message" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
			</p>

			<p>
				<label for="email">メールアドレス:</label>
				<input id="email" type="email" th:field="*{email}" required>
				<div class="error-message" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>
			</p>

			<p>
				<label for="password">パスワード:</label>
				<input id="password" type="password" th:field="*{password}" required>
				<div class="error-message" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></div>
			</p>

			<p>
				<label for="passwordConfirm">パスワード確認:</label>
				<input id="passwordConfirm" type="password" th:field="*{passwordConfirm}" required>
				<div class="error-message" th:if="${#fields.hasErrors('passwordConfirm')}" th:errors="*{passwordConfirm}"></div>
				<div id="password-match-message" class="error-message" style="display: none;">パスワードが一致しません。</div>
			</p>

			<div class="button-group">
				<button type="submit" id="submit-button">登録する</button>
				<a th:href="@{/login}" class="button">ログインへ戻る</a>
			</div>
		</form>
	</div>

	<script>
		const passwordInput = document.getElementById('password');
		const passwordConfirmInput = document.getElementById('passwordConfirm');
		const passwordMatchMessage = document.getElementById('password-match-message');
		const submitButton = document.getElementById('submit-button');
		const form = document.querySelector('form');

		function checkPasswordMatch() {
			const password = passwordInput.value;
			const passwordConfirm = passwordConfirmInput.value;

			if (passwordConfirm.length === 0) {
				passwordMatchMessage.style.display = 'none';
				passwordConfirmInput.style.borderColor = '';
				return;
			}

			if (password !== passwordConfirm) {
				passwordMatchMessage.style.display = 'block';
				passwordConfirmInput.style.borderColor = '#999';
				passwordConfirmInput.style.boxShadow = '0 0 0 4px rgba(0, 0, 0, 0.1)';
			} else {
				passwordMatchMessage.style.display = 'none';
				passwordConfirmInput.style.borderColor = '';
				passwordConfirmInput.style.boxShadow = '';
			}
		}

		passwordInput.addEventListener('input', checkPasswordMatch);
		passwordConfirmInput.addEventListener('input', checkPasswordMatch);

		form.addEventListener('submit', function(e) {
			const password = passwordInput.value;
			const passwordConfirm = passwordConfirmInput.value;

			if (password !== passwordConfirm) {
				e.preventDefault();
				passwordMatchMessage.style.display = 'block';
				passwordConfirmInput.focus();
				return false;
			}
		});
	</script>
</body>

</html>

