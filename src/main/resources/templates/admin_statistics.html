<!-- HTML5 文書宣言 -->
<!DOCTYPE html>
<!-- ルート要素。日本語と Thymeleaf/Spring Security Dialect を宣言 -->
<html lang="ja" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<!-- ヘッダー領域 -->

<head>
	<!-- 文字コード指定 -->
	<meta charset="UTF-8">
	<!-- ページタイトル -->
	<title>管理者: 統計データ - フリマアプリ</title>
	<!-- 共通 CSS の読込 -->
	<link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<!-- 本体 -->

<body>
	<!-- 共通ヘッダー -->
	<div th:replace="~{fragments/header :: header}"></div>
	<!-- レイアウト用の中央コンテナ -->
	<div class="container">
		<!-- 見出し -->
		<h1>管理者: 統計データ</h1>
		<!-- ページ説明 -->
		<p>フリマアプリの売上や注文に関する統計データです。</p>
		<!-- 期間指定フォーム（GET で再表示） -->
		<form th:action="@{/admin/statistics}" method="get" class="filter-form">
			<!-- 開始日の入力欄 -->
			<div>
				<!-- 開始日のラベル -->
				<label for="startDate">開始日:</label>
				<!-- startDate を yyyy-MM-dd でフォーマットして初期値に設定 -->
				<input type="date" id="startDate" name="startDate"
					th:value="${#temporals.format(startDate, 'yyyy-MM-dd')}">
			</div>
			<!-- 終了日の入力欄 -->
			<div>
				<!-- 終了日のラベル -->
				<label for="endDate">終了日:</label>
				<!-- endDate を yyyy-MM-dd でフォーマットして初期値に設定 -->
				<input type="date" id="endDate" name="endDate" th:value="${#temporals.format(endDate, 'yyyy-MM-dd')}">
			</div>
			<!-- フィルタボタン -->
			<button type="submit" class="button">フィルタ</button>
		</form>
		<!-- CSV エクスポートリンク。現在の期間パラメータを付加 -->
		<a th:href="@{/admin/statistics/csv(startDate=${startDate}, endDate=${endDate})}" class="button">CSV エクスポート</a>
		<!-- 総売上の見出し -->
		<h2>総売上</h2>
		<!-- 通貨表記で総売上を表示 -->
		<p class="price" th:text="'¥' + ${#numbers.formatDecimal(totalSales, 0, 'COMMA', 0,'POINT')}"></p>
		<!-- ステータス別件数の見出し -->
		<h2>ステータス別注文数</h2>
		<!-- ステータス別件数の表 -->
		<table>
			<!-- 列見出し -->
			<thead>
				<tr>
					<th>ステータス</th>
					<th>注文数</th>
				</tr>
			</thead>
			<!-- 本体 -->
			<tbody>
				<!-- orderCountByStatus（Map）をエントリでループ -->
				<tr th:each="entry : ${orderCountByStatus}">
					<!-- Map のキー（ステータス）を表示 -->
					<td th:text="${entry.key}"></td>
					<!-- Map の値（件数）を表示 -->
					<td th:text="${entry.value}"></td>
				</tr>
				<!-- データが空の場合の表示 -->
				<tr th:if="${#maps.isEmpty(orderCountByStatus)}">
					<!-- 全列結合でメッセージ表示 -->
					<td colspan="2">データがありません。</td>
				</tr>
			</tbody>
		</table>
		<!-- 戻るボタン -->
		<div class="button-group">
			<!-- 管理者ダッシュボードへ戻る -->
			<a th:href="@{/admin/dashboard}" class="button secondary">管理者ダッシュボードに戻る</a>
		</div>
	</div>
</body>

</html>